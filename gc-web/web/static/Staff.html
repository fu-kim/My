<div class="card">
    <div class="card-header bg-light">
        职员信息
    </div>
    <div class="col-md-4" style="text-align: center;position: relative;left: 30%">
        <label for="findId">查询职员</label>
        <div class="input-group">
            <input type="text" id="findId" name="sId" class="form-control" placeholder="职员编号">
            <span class="input-group-btn">
                            <button onclick="findStaff()" type="button" class="btn btn-primary"><i class="fa fa-search"></i> Find</button>
                        </span>
        </div>
    </div>
    <br>
    <button class="btn btn-outline-primary" data-toggle="modal" data-target="#modal-4">录入职员信息</button>
    <div class="card-body">
        <div class="table-responsive">
            <table class="table table-striped">
                <thead>
                <tr>
                    <th>职员编号</th>
                    <th>职员姓名</th>
                    <th>职员年龄</th>
                    <th>职员类型</th>
                    <th>职员电话</th>
                    <th>入职时间</th>
                    <th>操作</th>
                </tr>
                </thead>
                <tbody id="t1">

                </tbody>

            </table>
            <div id="page"></div>
        </div>
    </div>
</div>
<div class="modal fade" id="modal-4" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel" aria-hidden="true">
    <div class="modal-dialog" role="document">
        <div class="modal-content">
            <div class="modal-header bg-primary border-0">
                <h5 class="modal-title text-white">录入职员信息</h5>
                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                    <span aria-hidden="true">&times;</span>
                </button>
            </div>

            <div class="modal-body p-5">
                <form id="inputStaff">
                    职员编号：<input name="sid" class="form-control" placeholder="职员编号" style="margin-bottom: 10px">
                    职员姓名：<input name="staffName"  class="form-control" placeholder="职员姓名" style="margin-bottom: 10px">
                    职员密码：<input name="staffPwd"  class="form-control" placeholder="职员密码" style="margin-bottom: 10px">
                    职员类型：<select name="staffType" id="insertStaffType" class="form-control">
                    <option value="1">管理员</option>
                    <option value="2">信息记录员</option>
                    <option value="3">垃圾处理员</option>
                    </select>
                    职员年龄：<input name="staffAge"  class="form-control" placeholder="职员年龄" style="margin-bottom: 10px">
                    职员电话：<input name="staffPhone"  class="form-control" placeholder="职员电话" style="margin-bottom: 10px">
                </form>
            </div>

            <div class="modal-footer border-0">
                <button type="button" class="btn btn-link" data-dismiss="modal" id="insertClose">关闭</button>
                <button type="button" class="btn btn-primary" onclick="insertStaff()">确定提交</button>
            </div>
        </div>
    </div>
</div>
<div class="modal fade" id="modal-5" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel" aria-hidden="true">
    <div class="modal-dialog" role="document">
        <div class="modal-content">
            <div class="modal-header bg-success border-0">
                <h5 class="modal-title text-white">修改垃圾总量信息</h5>
                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                    <span aria-hidden="true">&times;</span>
                </button>
            </div>

            <div class="modal-body p-5">
                <form id="updateStaff">
                    职员编号：<input id="updatesId" name="sid" class="form-control" placeholder="职员编号" style="margin-bottom: 10px" readonly>
                    职员姓名：<input name="staffName"  class="form-control" placeholder="职员姓名" style="margin-bottom: 10px">
                    职员密码：<input name="staffPwd"  class="form-control" placeholder="职员密码" style="margin-bottom: 10px">
                    职员年龄：<input name="staffAge"  class="form-control" placeholder="职员年龄" style="margin-bottom: 10px">
                    职员电话：<input name="staffPhone"  class="form-control" placeholder="职员电话" style="margin-bottom: 10px">
                    入职时间：<input name="staffEntryTime"  class="form-control" placeholder="入职时间" style="margin-bottom: 10px">
                </form>
            </div>

            <div class="modal-footer border-0">
                <button type="button" class="btn btn-link" data-dismiss="modal" id="updateClose">关闭</button>
                <button type="button" class="btn btn-success" onclick="updateStaff()">确定修改</button>
            </div>
        </div>
    </div>
</div>
<div class="modal fade" id="modal-13" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel" aria-hidden="true">
    <div class="modal-dialog" role="document">
        <div class="modal-content bg-danger">
            <div class="modal-header border-0">
                <h5 class="modal-title text-white">删除数据</h5>
                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                    <span aria-hidden="true">&times;</span>
                </button>
            </div>

            <div class="modal-body text-white p-5">
                <input type="hidden" id="deletesId">
                <i style="font-size: 30px">你确定删除该条数据吗？</i>
            </div>

            <div class="modal-footer border-0">
                <button type="button" class="btn btn-danger" data-dismiss="modal"  id="deleteClose">关闭</button>
                <button type="button" class="btn btn-danger" onclick="deleteStaff()">确定删除</button>
            </div>
        </div>
    </div>
</div>
<div class="modal fade" id="modal-7" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel" aria-hidden="true">
    <div class="modal-dialog" role="document">
        <div class="modal-content">
            <div class="modal-header bg-warning border-0">
                <h5 class="modal-title text-white">权限修改</h5>
                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                    <span aria-hidden="true">&times;</span>
                </button>
            </div>

            <div class="modal-body p-5">
                <input type="hidden" id="staffUpdateId">
                权限类型：<select id="staffType" class="form-control">
                <option value="1">管理员</option>
                <option value="2">垃圾处理员</option>
                <option value="3">信息记录员</option>
                </select>
                <br>
                <input id="adminPwd"  class="form-control" placeholder="请输入管理员认证密码" style="margin-bottom: 10px">
            </div>

            <div class="modal-footer border-0">
                <button type="button" class="btn btn-link" data-dismiss="modal" id="authClose">关闭</button>
                <button type="button" class="btn btn-warning text-white" onclick="updateStaffType()">确定修改</button>
            </div>
        </div>
    </div>
</div>

<script>

    function sList() {
        $.ajax({
            url:"../sList",
            method:"get",
            data:{'pageNum':1,'pageSize':10},
            success:function (result) {
                if (result.code == 200){
                    addTable(result.data)
                    page(result.data)
                }else{
                    alert(result.message);
                }
            }
        })
    }
    sList();

   function addTable(dataList){
       $("#t1").empty();
       $.each(dataList.list,function (index,obj) {
           $("#t1").append('<tr>'
               +'<td>'+obj.sid+'</td>'
               +'<td class="text-nowrap">'+obj.staffName+'</td>'
               +'<td>'+obj.staffAge+' </td>'
               +'<td>'+obj.staffType+' </td>'
               +'<td>'+obj.staffPhone+' </td>'
               +'<td>'+obj.staffEntryTime+' </td>'
               +'<td><button class="btn btn-outline-success" data-toggle="modal" data-target="#modal-5" id="'+obj.sid+'" onclick="updateLoadSid(this.id)">修改</button> ' +
               '<button class="btn btn-outline-danger" data-toggle="modal" data-target="#modal-13" id="'+obj.sid+'" onclick="deleteLoadSid(this.id)">删除</button> ' +
               '<button class="btn btn-outline-warning" data-toggle="modal" data-target="#modal-7" id="'+obj.sid+'" onclick="updateStaffLoadSid(this.id)">修改权限</button> </td>'
               +'</tr>')

       })
   }
   //分页
   function page(pageInfo){
       $("#page").pagination(pageInfo.total, { //第一个参数指定共多少条记录
           items_per_page:pageInfo.pageSize, // 每页显示多少条记录
           next_text:">", //下一页按钮图标
           prev_text:"<", //上一页按钮图标
           num_display_entries:5,//主体页数
           num_edge_entries: 2, //边缘页数
           callback: function(index){//定义一个回调函数，用于每次点击页码发起分页查询请求
               //index为当前页码，只不过下标是从0开始，因此需要+1操作
               var pageNum = ++index;
               $.ajax({
                   url : '../sList',
                   method : 'get',
                   data : {'pageNum' : pageNum, 'pageSize' : 10},
                   success : function(result){
                       //渲染表格
                       addTable(result.data);
                   }
               });
           }
       });
   }
   function findStaff() {
       $.ajax({
           url:"../getsListById",
           method:"get",
           data:{'pageNum':1,'pageSize':20,'sId':$("#findId").val()},
           success:function (result) {
               if (result.code == 200){
                   addTable(result.data)
                   page(result.data)
               }else{
                   alert(result.message);
               }
           }
       })
   }

   function insertStaff() {
       $.ajax({
           url:"../insertStaff",
           method:"post",
           data:$("#inputStaff").serialize(),
           success:function (result) {
               if (result.code == 200){
                   $("#insertClose").click();
                   alert(result.message);
                   sList();
               }else{
                   alert(result.message);
               }
           }
       })
   }
   function updateStaff() {
       $.ajax({
           url:"../updateStaff",
           method:"post",
           data:$("#updateStaff").serialize(),
           success:function (result) {
               if (result.code == 200){
                   $("#updateClose").click();
                   alert(result.message);
                   sList();
               }else{
                   alert(result.message);
               }
           }
       })
   }

   function deleteStaff() {
       $.ajax({
           url:"../deleteStaff",
           method:"post",
           data:{"sId":$("#deletesId").val()},
           success:function (result) {
               if (result.code == 200){
                   $("#deleteClose").click();
                   alert(result.message);
                   sList();
               }else{
                   alert(result.message);
               }
           }
       })
   }

    function updateStaffType() {
        $.ajax({
            url:"../getPwd",
            method:"post",
            data:{"adminPwd":$("#adminPwd").val()},
            success:function (result) {
                if (result.code == 200){
                    $.ajax({
                        url:"../updateStaffType",
                        method:"post",
                        data:{"sid":$("#staffUpdateId").val(),"staffType":$("#staffType").val()},
                        success:function (result) {
                            if (result.code == 200){
                                $("#authClose").click();
                                alert(result.message+"11");
                                sList();
                            }else{
                                alert(result.message+"22");
                            }
                        }
                    })
                }else{
                    alert(result.message);
                }
            }
        })
    }
   function updateLoadSid(id) {
       $("#updatesId").val(id);
   }
   function deleteLoadSid(id) {
       $("#deletesId").val(id);
   }
   function updateStaffLoadSid(id) {
        $("#staffUpdateId").val(id);
   }
</script>
</body>
</html>
